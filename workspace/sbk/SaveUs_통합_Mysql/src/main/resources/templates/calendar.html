<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout}">

<head>
    <title>캘린더</title>

    <th:block layout:fragment="css">
        <link rel="stylesheet" th:href="@{/css/calendar.css}">
    </th:block>


</head>

<main layout:fragment="content">
    <div class="calendar-guide-section">
        <div>
            <h2 class="guide-title">건강점수 캘린더</h2>
            <p class="guide-text">
                매일 기록한 식단 데이터를 기반으로 건강점수가 자동 계산되며,
                날짜를 선택해서 그날의 식단 기록을 확인할 수 있습니다.
            </p>
        </div>
    </div>

    <div class="calendar-wrapper">

        <div class="calendar-container">

            <div class="calendar-header">
                <div class="month-nav">
                    <a class="nav-btn"
                       th:href="@{/calendar(year=${year}, month=${month - 1})}">
                        이전달
                    </a>
                </div>

                <h2 th:text="${year} + '년 ' + ${month} + '월'"></h2>

                <div class="month-nav">
                    <a class="nav-btn"
                       th:href="@{/calendar(year=${year}, month=${month + 1})}">
                        다음달
                    </a>
                </div>
            </div>

            <div class="calendar-grid weekday-row">
                <div class="weekday">일</div>
                <div class="weekday">월</div>
                <div class="weekday">화</div>
                <div class="weekday">수</div>
                <div class="weekday">목</div>
                <div class="weekday">금</div>
                <div class="weekday">토</div>
            </div>

            <div class="calendar-grid">
                <div th:each="day : ${days}" class="day-box"
                     th:classappend="${day.date == today} ? ' today'"
                     th:data-date="${day.date}"
                     onclick="selectDate(this)">

                    <div th:if="${day.date != null}">
                        <div class="day-number" th:text="${day.date.dayOfMonth}"></div>

                        <div th:if="${day.score != null}"
                             class="score-fill"
                             th:text="${day.score}"
                             th:style="'background:' + ${day.color} + '; color:#000000'">
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="side-panel" id="sidePanel">
            <div class="panel-header">
                <h3 id="panelDateTitle">날짜를 선택하세요</h3>
                <button class="close-btn" onclick="closePanel()">×</button>
            </div>

            <div id="mealListContainer" class="meal-list-area">
                <p class="empty-msg">기록을 불러오는 중...</p>
            </div>
        </div>

    </div> <div class="legend-box">
    <div class="legend-title">건강점수</div>

    <div class="legend-list">
        <div class="legend-item">
            <div class="legend-color legend-green"></div>
            <span>80~100 : 우수</span>
        </div>
        <div class="legend-item">
            <div class="legend-color legend-yellow"></div>
            <span>40~79 : 보통</span>
        </div>
        <div class="legend-item">
            <div class="legend-color legend-red"></div>
            <span>0~39 : 개선 필요</span>
        </div>
    </div>
</div>

</main>
<th:block layout:fragment="script">
    <script th:src="@{/js/calendar.js}"></script>
</th:block>
</html>