-- USERS : 사용자의 기본정보  테이블
CREATE SEQUENCE USERS_SEQ
    START WITH 1
    INCREMENT BY 1
    NOCACHE;

CREATE TABLE USERS (
USER_ID           NUMBER PRIMARY KEY,
EMAIL             VARCHAR2(100) NOT NULL,
PASSWORD          VARCHAR2(255) NOT NULL,
NICKNAME          VARCHAR2(50)  NOT NULL,
BIRTHDATE DATE,
AGE NUMBER,
GENDER VARCHAR2(10),
HEIGHT            NUMBER,
CURRENT_WEIGHT    NUMBER,
MAIN_GOAL         NUMBER NOT NULL,
PROFILE_IMAGE_URL VARCHAR2(255),
CREATED_AT DATE DEFAULT SYSDATE,
STATUS            VARCHAR2(20) DEFAULT 'ACTIVE',
ROLE              VARCHAR2(20) DEFAULT 'USER',

CONSTRAINT UK_USERS_EMAIL UNIQUE (EMAIL)
);


-- MEAL_ENTRY : 사용자 한 끼 식사 기록 테이블
CREATE TABLE MEAL_ENTRY (
    ENTRY_ID        NUMBER GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
    USER_ID         NUMBER           NOT NULL,
    MEAL_NAME       VARCHAR2(255)    NOT NULL,
    EAT_TIME        TIMESTAMP        NOT NULL,
    CALORIES_KCAL   NUMBER           DEFAULT 0 NOT NULL,
    PROTEIN_G       NUMBER           DEFAULT 0 NOT NULL,
    CARBS_G         NUMBER           DEFAULT 0 NOT NULL,
    FATS_G          NUMBER           DEFAULT 0 NOT NULL,
    SUGAR_G         NUMBER           DEFAULT 0 NOT NULL,
    FIBER_G         NUMBER           DEFAULT 0 NOT NULL,  
    CALCIUM_MG      NUMBER           DEFAULT 0 NOT NULL,
    SODIUM_MG       NUMBER           DEFAULT 0 NOT NULL,
    CREATED_AT      TIMESTAMP        DEFAULT SYSTIMESTAMP NOT NULL,

    CONSTRAINT FK_ME_USER FOREIGN KEY (USER_ID)
        REFERENCES USERS(USER_ID)
);

-- 식품 및 영양 성분 테이블
CREATE TABLE FOOD_NUTRITION (
    FOOD_ID        NUMBER GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
    FOOD_NAME      VARCHAR2(100)   NOT NULL UNIQUE,
    CATEGORY       VARCHAR2(100)   NOT NULL,
    CALORIES_KCAL  NUMBER          DEFAULT 0,
    CARBS_G        NUMBER          DEFAULT 0,
    PROTEIN_G      NUMBER          DEFAULT 0,
    FAT_G          NUMBER          DEFAULT 0,
    SUGAR_G        NUMBER          DEFAULT 0,
    FIBER_G        NUMBER          DEFAULT 0,
    CALCIUM_MG     NUMBER          DEFAULT 0,
    SODIUM_MG      NUMBER          DEFAULT 0
);

-- USER_GOAL : 사용자 목표 영양 정보 테이블
CREATE TABLE USER_GOAL (
    GOAL_ID        NUMBER GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
    USER_ID        NUMBER       NOT NULL,
    CALORIES_KCAL  NUMBER       NOT NULL,
    PROTEIN_G      NUMBER       NOT NULL,
    CARBS_G        NUMBER       NOT NULL,
    FATS_G         NUMBER       NOT NULL,

    CONSTRAINT FK_UG_USER FOREIGN KEY (USER_ID)
        REFERENCES USERS(USER_ID)
);

-- HEALTH_SCORE_DAILY : 사용자 하루 건강 점수 테이블
CREATE TABLE HEALTH_SCORE_DAILY (
    SCORE_ID        NUMBER GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
    USER_ID         NUMBER       NOT NULL,
    SCORE_DATE      DATE         NOT NULL,
    SCORE           NUMBER       NOT NULL,
    STATUS_MESSAGE  VARCHAR2(50),

    CONSTRAINT FK_HSD_USER FOREIGN KEY (USER_ID)
        REFERENCES USERS(USER_ID),
    CONSTRAINT UQ_HSD_USER_DATE UNIQUE (USER_ID, SCORE_DATE),
    CONSTRAINT CK_HSD_SCORE CHECK (SCORE BETWEEN 0 AND 100)
);

-- POSTS : 사용자 커뮤니티 게시글 테이블
CREATE TABLE POSTS (
    POST_ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    USER_ID NUMBER NOT NULL,
    CONTENT VARCHAR2(4000),
    HEALTH_SCORE NUMBER(3,0),
    CREATED_AT TIMESTAMP DEFAULT SYSTIMESTAMP,
    CONSTRAINT FK_POSTS_USERS FOREIGN KEY (USER_ID)
        REFERENCES USERS(USER_ID) ON DELETE CASCADE
);

-- COMMENTS : 게시글 댓글 테이블
CREATE TABLE COMMENTS (
    COMMENT_ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    POST_ID NUMBER NOT NULL,
    USER_ID NUMBER NOT NULL,
    CONTENT VARCHAR2(2000) NOT NULL,
    CREATED_AT TIMESTAMP DEFAULT SYSTIMESTAMP,
    CONSTRAINT FK_COMMENTS_POSTS FOREIGN KEY (POST_ID)
        REFERENCES POSTS(POST_ID) ON DELETE CASCADE, 
    CONSTRAINT FK_COMMENTS_USERS FOREIGN KEY (USER_ID)
        REFERENCES USERS(USER_ID) ON DELETE CASCADE
);

-- LIKES : 게시물 좋아요 테이블
CREATE TABLE LIKES (
    LIKE_ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    POST_ID NUMBER NOT NULL,
    USER_ID NUMBER NOT NULL,
    CREATED_AT TIMESTAMP DEFAULT SYSTIMESTAMP,
    CONSTRAINT FK_LIKES_POSTS FOREIGN KEY (POST_ID)
        REFERENCES POSTS(POST_ID) ON DELETE CASCADE, 
    CONSTRAINT FK_LIKES_USERS FOREIGN KEY (USER_ID)
        REFERENCES USERS(USER_ID) ON DELETE CASCADE,
    CONSTRAINT UK_LIKES_POST_USER UNIQUE (POST_ID, USER_ID)
);

-- POST_IMAGES : 게시글 이미지 저장 테이블
CREATE TABLE POST_IMAGES (
    IMAGE_ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    POST_ID NUMBER NOT NULL,
    IMAGE_URL VARCHAR2(1000) NOT NULL,
    DISPLAY_ORDER NUMBER DEFAULT 1 NOT NULL,
    CONSTRAINT FK_POST_IMAGES FOREIGN KEY (POST_ID)
        REFERENCES POSTS(POST_ID) ON DELETE CASCADE
);

-- 설문지 테이블
CREATE TABLE USER_DIET_TYPE (
    USER_ID NUMBER PRIMARY KEY,
    PROTEIN_TYPE VARCHAR2(20),
    FAT_TYPE VARCHAR2(20),
    CARB_TYPE VARCHAR2(20),
    DIET_TYPE VARCHAR2(50),
    UPDATED_AT TIMESTAMP DEFAULT SYSTIMESTAMP,
    CONSTRAINT FK_USER_DIET_TYPE_USERS
        FOREIGN KEY (USER_ID)
        REFERENCES USERS(USER_ID)
        ON DELETE CASCADE
);


