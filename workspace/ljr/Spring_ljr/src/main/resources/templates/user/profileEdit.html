<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout}">

<head>
    <meta charset="UTF-8">
    <title>프로필 수정</title>

    <link rel="stylesheet" th:href="@{/css/layout.css}">
    <link rel="stylesheet" th:href="@{/css/myPageEdit.css}">

</head>

<main layout:fragment="content">

    <h2 class="edit-title">프로필 수정</h2>
    <p class="edit-sub">회원 정보를 변경합니다.</p>

    <form th:action="@{/profile/edit}" th:object="${user}"
          method="post" enctype="multipart/form-data">

        <section class="profile-edit-card">

            <!-- 상단 배너 -->
            <div class="edit-banner"></div>

            <div class="edit-profile-container">

                <!-- 프로필 이미지 영역 -->
                <div class="profile-img-wrapper">
                    <img class="edit-profile-img"
                         id="profilePreview"
                         th:src="${user.profileImageUrl != null ? user.profileImageUrl : '/images/user-default.png'}"
                         alt="Profile Image">

                    <!-- 숨겨진 이미지 업로드 input -->
                    <input type="file" id="profileImageInput"
                           name="profileImage"
                           accept="image/*"
                           style="display:none;">

                    <button type="button" class="change-img-btn"
                            onclick="document.getElementById('profileImageInput').click()">
                        이미지 변경
                    </button>
                </div>

                <!-- 입력 항목들 -->
                <div class="edit-profile-info">

                    <!-- 닉네임 -->
                    <div class="form-group">
                        <label>닉네임</label>
                        <input type="text" class="input-box"
                               th:field="*{nickname}" maxlength="12" readonly>
                    </div>

                    <!-- 이메일 -->
                    <div class="form-group">
                        <label>이메일</label>
                        <input type="email" class="input-box"
                               th:value="${user.email}" readonly>
                    </div>

                    <!-- 생년월일 + 나이 -->
                    <div class="form-row two-col">

                        <div class="form-group">
                            <label>생년월일</label>
                            <input type="date" class="input-box"
                                   th:field="*{birthdate}" readonly>
                        </div>

                        <div class="form-group">
                            <label>나이</label>
                            <input type="number" class="input-box"
                                   th:value="${user.age}" readonly>
                        </div>
                    </div>

                    <!-- 목표 -->
                    <div class="form-group">
                        <label>목표</label>
                        <select class="input-box" th:field="*{mainGoal}">
                            <option value="0">감량</option>
                            <option value="1">증량</option>
                            <option value="2">건강식</option>
                        </select>
                    </div>

                    <!-- 키 + 체중 -->
                    <div class="form-row two-col key-weight">

                        <div class="form-group">
                            <label>키</label>
                            <div class="input-row">
                                <input type="number" class="input-box small" th:field="*{height}" min="1" max="250">
                                <span class="unit-label">cm</span>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>체중</label>
                            <div class="input-row">
                                <input type="number" class="input-box small" th:field="*{currentWeight}" min="1" max="300">
                                <span class="unit-label">kg</span>
                            </div>
                        </div>
                    </div>
                </div> <!-- edit-profile-info end -->
            </div> <!-- edit-profile-container end -->

            <!-- 수정 완료 버튼 -->
            <button type="submit" class="save-profile-btn">수정 완료</button>
        </section>
    </form>


    <section class="password-card">

        <h3 class="pw-title">비밀번호 변경</h3>
        <p class="pw-sub">안전한 사용을 위해 정기적으로 비밀번호를 변경하세요.</p>

        <form th:action="@{/profile/password}" method="post" class="pw-form">

            <div class="pw-inputs">

                <div class="form-group">
                    <label>현재 비밀번호</label>
                    <input type="password" name="currentPassword" class="input-box" required>
                </div>

                <div class="form-group">
                    <label>새 비밀번호</label>
                    <input type="password" name="newPassword" class="input-box" required>
                </div>

                <div class="form-group">
                    <label>새 비밀번호 확인</label>
                    <input type="password" name="confirmPassword" class="input-box" required>
                </div>
                <p id="pwCheckMsg" class="pw-msg"></p>

                <button type="submit" class="pw-update-btn" id="pwSubmitBtn" disabled>비밀번호 변경</button>
            </div>
        </form>
    </section>

    <!-- 외부 스크립트 연결 -->
    <script th:src="@{/js/profileEdit.js}"></script>
</main>
</html>
