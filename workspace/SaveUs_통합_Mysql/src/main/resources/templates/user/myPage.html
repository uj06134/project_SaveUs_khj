<!--
<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"
  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
  layout:decorate="~{layout}">

<head>
<meta charset="UTF-8">
<title>My Page</title>
<link rel="stylesheet" th:href="@{/css/myPage.css}">
</head>

<main layout:fragment="content">
&lt;!&ndash; 페이지 제목 &ndash;&gt;
<h2 class="mypage-title">마이페이지</h2>

&lt;!&ndash; 프로필 카드 &ndash;&gt;
<section class="profile-section">
    <div class="profile-card">

        <div class="profile-banner"></div>

        <div class="profile-inner">

            &lt;!&ndash; 프로필 이미지 &ndash;&gt;
            <img class="profile-img"
                 th:src="${(user.profileImageUrl != null && user.profileImageUrl != '')
                     ? user.profileImageUrl
                     : '/images/user-no_video.png'}"
                 alt="user">

            <div class="profile-info">
                <h3 class="profile-name" th:text="${user.nickname}">닉네임</h3>


                <span class="persona-tag">
                    <span th:switch="${user.mainGoal}">
                        <span th:case="0">감량</span>
                        <span th:case="1">증량</span>
                        <span th:case="2">건강식</span>
                        <span th:case="*">목표 없음</span>
                    </span>
                </span>

                <span class="persona-tag" style="background:#66c4ff;">
                    <span th:text="${dietType != null ? dietType : '미분석'}"></span>
                </span>

                &lt;!&ndash; 성별 &ndash;&gt;
                <p>
                    <strong>성별 :</strong>
                    <span th:text="${user.gender == 'M' ? '남성' : '여성'}"></span>
                </p>

                <p>
                    <strong>키 :</strong>
                    <span th:text="${user.height + 'cm'}"></span> |

                    <strong>체중 :</strong>
                    <span th:text="${user.currentWeight + 'kg'}"></span> |


                    <strong>BMI :</strong>
                    <span th:text="${user.bmi}"></span>
                </p>

                &lt;!&ndash; 이메일 &ndash;&gt;
                <p><strong>이메일 :</strong> <span th:text="${user.email}"></span></p>

                &lt;!&ndash; 가입일 &ndash;&gt;
                <p>
                    <strong>가입일 :</strong>
                    <span th:text="${user.createdAt != null ? #temporals.format(user.createdAt, 'yyyy-MM-dd') : '-'}"></span>
                </p>
            </div>


            &lt;!&ndash; 편집 버튼  &ndash;&gt;
            <button class="btn-edit" onclick="location.href='/profile/edit'">프로필 수정</button>
        </div>
    </div>
</section>

    &lt;!&ndash; 획득한 뱃지 &ndash;&gt;
    <section class="badge-section">
        <h3>획득 뱃지</h3>

        <div class="badge-list">
            <div class="badge-card" th:each="b : ${badges}">
                <img th:src="${b.imageUrl}" alt="">
                <h4 th:text="${b.title}">뱃지 이름</h4>
                <p th:text="${b.description}">뱃지 설명</p>
            </div>

            &lt;!&ndash; 뱃지가 없을 때 메시지 &ndash;&gt;
            <p th:if="${#lists.isEmpty(badges)}" style="color:#aaa; margin-top:10px;">
                아직 획득한 뱃지가 없습니다.
            </p>
        </div>
    </section>

&lt;!&ndash; 하단 활동중인 챌린지 진행상황 &ndash;&gt;
    <section class="challenge-section">
        <h3>진행 중인 챌린지</h3>

        <div class="challenge-list">

            <div class="challenge-card" th:each="c : ${challenges}">
                <h4 th:text="${c.title}">챌린지 제목</h4>

                <p th:text="${c.description}">챌린지 설명</p>

                <div class="progress-bar">
                    <div class="fill"
                         th:style="'width:' + ${c.progressPercent} + '%'"></div>
                </div>

                <p class="percent" th:text="${c.progressPercent + '% 진행중!'}"></p>
            </div>

            <p th:if="${#lists.isEmpty(challenges)}" style="color:#aaa; margin-top:10px;">
                진행 중인 챌린지가 없습니다.
            </p>

        </div>
    </section>


&lt;!&ndash; 로그아웃 & 회원탈퇴 &ndash;&gt;
<section class="account-section">
    <h3>계정 관리</h3>

    <button class="btn-logout" onclick="location.href='/logout'">로그아웃</button>
    <button class="btn-delete" onclick="deleteAccount()">회원 탈퇴</button>
</section>


<script src="/js/mypage.js"></script>

<th:block th:if="${user == null}">
    <script>
        requireLogin();
    </script>
</th:block>
</main>
</html>
-->
<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout}">

<head>
    <meta charset="UTF-8">
    <title>My Page</title>
    <link rel="stylesheet" th:href="@{/css/myPage.css}">
</head>

<main layout:fragment="content">

    <div class="mypage-container">
        <h2 class="mypage-title">마이페이지</h2>

        <section class="profile-section">
            <div class="profile-card">
                <div class="profile-banner"></div>

                <div class="profile-content">
                    <div class="profile-header">
                        <div class="profile-img-wrapper">
                            <img class="profile-img"
                                 th:src="${(user.profileImageUrl != null && user.profileImageUrl != '')
                                     ? user.profileImageUrl
                                     : '/images/user-default.png'}"
                                 alt="user">
                            <button class="btn-edit-icon" onclick="location.href='/profile/edit'" title="프로필 수정">
                                ⚙️
                            </button>
                        </div>

                        <div class="profile-text">
                            <div class="name-row">
                                <h3 class="profile-name" th:text="${user.nickname}">닉네임</h3>
                                <span class="goal-badge" th:switch="${user.mainGoal}">
                                    <span th:case="0">🏃 다이어트</span>
                                    <span th:case="1">💪 벌크업</span>
                                    <span th:case="2">🥗 건강관리</span>
                                    <span th:case="*">목표 설정</span>
                                </span>
                            </div>

                            <p class="email-text" th:text="${user.email}">user@example.com</p>

                            <div class="profile-meta">
                                <span>가입일: <span th:text="${user.createdAt != null ? #temporals.format(user.createdAt, 'yyyy.MM.dd') : '-'}"></span></span>
                                <span class="divider">|</span>
                                <span>성별: <span th:text="${user.gender == 'M' ? '남성' : '여성'}"></span></span>
                            </div>
                        </div>
                    </div>

                    <div class="profile-stats">
                        <div class="stat-box">
                            <span class="label">키</span>
                            <strong class="value" th:text="${user.height} + ' cm'">180 cm</strong>
                        </div>
                        <div class="stat-box">
                            <span class="label">체중</span>
                            <strong class="value" th:text="${user.currentWeight} + ' kg'">75 kg</strong>
                        </div>
                        <div class="stat-box">
                            <span class="label">BMI</span>
                            <strong class="value bmi-value" th:text="${user.bmi}">23.1</strong>
                        </div>
                        <div class="stat-box">
                            <span class="label">식단 유형</span>
                            <strong class="value type-value" th:text="${dietType != null ? dietType : '미분석'}">저탄고지</strong>
                        </div>
                    </div>

                </div>
            </div>
        </section>

        <section class="badge-section">
            <h3>획득 뱃지</h3>

            <div class="badge-grid">
                <div class="badge-card" th:each="b : ${badges}">
                    <div class="badge-icon-wrapper">
                        <img th:src="${b.imageUrl}" alt="Badge Icon">
                    </div>
                    <div class="badge-info">
                        <h4 th:text="${b.title}">뱃지 이름</h4>
                        <p th:text="${b.description}">설명</p>
                    </div>
                </div>

                <div th:if="${#lists.isEmpty(badges)}" class="empty-state">
                    <p>아직 획득한 뱃지가 없습니다.<br>챌린지를 완료하고 뱃지를 모아보세요!</p>
                </div>
            </div>
        </section>

        <section class="challenge-section">
            <h3>진행 중인 챌린지</h3>

            <div class="my-challenge-grid">
                <div class="challenge-card-simple" th:each="c : ${challenges}">
                    <div class="card-top">
                        <h4 th:text="${c.title}">챌린지 제목</h4>
                        <span class="percent-badge" th:text="${c.progressPercent + '%'}">50%</span>
                    </div>

                    <p class="desc" th:text="${c.description}">설명</p>

                    <div class="progress-bar-wrapper">
                        <div class="progress-bar">
                            <div class="fill" th:style="'width:' + ${c.progressPercent} + '%'"></div>
                        </div>
                    </div>
                </div>

                <div th:if="${#lists.isEmpty(challenges)}" class="empty-state">
                    <p>현재 진행 중인 챌린지가 없습니다.</p>
                    <a href="/challenges" class="link-text">챌린지 둘러보기 &rarr;</a>
                </div>
            </div>
        </section>

        <section class="account-section">
            <h3>계정 관리</h3>
            <div class="account-actions">
                <button class="btn-logout" onclick="location.href='/logout'">로그아웃</button>
                <button class="btn-delete" onclick="deleteAccount()">회원 탈퇴</button>
            </div>
        </section>
    </div>

    <script src="/js/mypage.js"></script>
    <th:block th:if="${user == null}">
        <script>requireLogin();</script>
    </th:block>

</main>
</html>
